# Анализ проекта: Визуализация рынка предпринимателей России

## Ключевые требования

### 1. Основная концепция
- 3D визуализация в виде звездного скопления
- Каждая звезда = группа компаний (агрегированные данные)
- ~6 млн компаний МСП в России (данные 2024)
- Интерактивность "как в игре"

### 2. Основные функции
- **3D навигация**: вращение, масштабирование, инерция
- **Динамические фильтры**: размер, отрасль, регион, банк
- **Режим карты**: трансформация в карту России
- **Статистика**: панели с данными по сегментам
- **Tooltips**: информация при наведении

### 3. Фильтры
1. **Размер компаний** (по выручке в млн руб):
   - 0-5 млн (микро)
   - 5-20 млн (малые)
   - 20-80 млн (средние малые)
   - 80-400 млн (крупные малые)
   - 400-800+ млн (средние)

2. **Отрасли** (ОКВЭД):
   - Топ-100 наиболее массовых кодов
   - Остальные в категории "Прочие"

3. **Регионы**:
   - Все субъекты РФ
   - Режим карты с географическим позиционированием

4. **Банки** (опционально):
   - Топ-10 банков по клиентам МСП
   - Категория "Другие"

## Техническая архитектура

### Технологии
- **Three.js**: 3D визуализация и анимации
- **D3.js**: обработка данных, цветовые шкалы
- **Vanilla JS**: основная логика без фреймворков
- **CSS3**: стили и адаптивность
- **WebGL**: производительная отрисовка

### Структура данных
```javascript
{
  companies: [
    {
      id: "group_001",
      count: 150,           // количество компаний в группе
      revenue_category: 1,  // 0-4 (категории выручки)
      industry_code: "62",  // код ОКВЭД
      region_code: "77",    // код региона
      bank_id: "sber",      // ID банка (опционально)
      coordinates: {        // для режима карты
        lat: 55.7558,
        lon: 37.6176
      }
    }
  ],
  metadata: {
    revenue_categories: [...],
    industries: [...],
    regions: [...],
    banks: [...]
  }
}
```

### Компоненты системы

1. **DataManager**: управление данными и фильтрацией
2. **Scene3D**: Three.js сцена и рендеринг
3. **FilterPanel**: интерфейс фильтров
4. **StatsPanel**: панель статистики
5. **TooltipManager**: всплывающие подсказки
6. **AnimationController**: анимации и переходы

### Оптимизация производительности
- Агрегация: 1 звезда = группа компаний (целевое количество ~10-50k звезд)
- LOD (Level of Detail): упрощение на дальних расстояниях
- Frustum culling: отрисовка только видимых объектов
- Instanced rendering: эффективная отрисовка множества объектов

## План реализации

### Этап 1: Базовая структура
- HTML каркас с панелями
- CSS для космического дизайна
- Подключение библиотек

### Этап 2: Данные
- Генератор тестовых данных
- Структура агрегации
- Загрузка и парсинг

### Этап 3: 3D визуализация
- Three.js сцена
- Система частиц
- Базовое управление камерой

### Этап 4: Фильтры
- Интерфейс фильтров
- Логика фильтрации
- Обновление визуализации

### Этап 5: Интерактивность
- Анимации переходов
- Режим карты
- Статистические панели

### Этап 6: Полировка
- Tooltips
- Оптимизация
- Тестирование

## Особенности реализации

### Режим карты России
- Координаты регионов РФ
- Плавная анимация трансформации
- Проекция Меркатора или равноугольная

### Цветовое кодирование
- Размер: градиент от синего к красному
- Отрасли: категориальная палитра
- Регионы: географическая палитра

### Анимации
- Инерционное вращение с затуханием
- Плавные переходы между режимами
- Эффекты появления/исчезновения звезд

### Адаптивность
- Полная поддержка десктопа
- Базовая поддержка планшетов
- Предупреждение для мобильных устройств

